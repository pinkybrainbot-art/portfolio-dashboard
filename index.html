<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <title>Portfolio Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      min-height: 100vh;
    }
    
    /* Login Screen */
    .login-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    .login-box {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 40px;
      width: 100%;
      max-width: 360px;
      text-align: center;
    }
    .login-box h1 { color: #58a6ff; margin-bottom: 10px; font-size: 1.5rem; }
    .login-box p { color: #8b949e; margin-bottom: 25px; font-size: 0.9rem; }
    .pin-input {
      width: 100%;
      padding: 15px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      color: #c9d1d9;
      font-size: 1.5rem;
      text-align: center;
      letter-spacing: 8px;
      margin-bottom: 15px;
    }
    .pin-input:focus { outline: none; border-color: #58a6ff; }
    .pin-input::placeholder { letter-spacing: normal; font-size: 1rem; }
    .login-error { color: #f85149; font-size: 0.85rem; margin-bottom: 15px; display: none; }
    .login-btn {
      width: 100%;
      padding: 12px;
      background: #238636;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }
    .login-btn:hover { background: #2ea043; }
    .app-content { display: none; }
    
    /* Navigation */
    .nav {
      background: #161b22;
      border-bottom: 1px solid #30363d;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 50;
      flex-wrap: wrap;
      gap: 10px;
    }
    .nav h1 { color: #58a6ff; font-size: 1.3rem; }
    .nav-tabs { display: flex; gap: 5px; flex-wrap: wrap; }
    .nav-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: #8b949e;
      cursor: pointer;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .nav-tab:hover { color: #c9d1d9; background: #21262d; }
    .nav-tab.active { color: #58a6ff; background: #21262d; }
    
    /* Main Container */
    .container { padding: 20px; max-width: 1400px; margin: 0 auto; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Cards */
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #30363d;
    }
    .card-title { font-weight: 600; font-size: 1rem; }
    
    /* Grid Layouts */
    .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
    @media (max-width: 900px) { .grid-4 { grid-template-columns: repeat(2, 1fr); } }
    
    /* Stats */
    .stat-card {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    .stat-value { font-size: 1.8rem; font-weight: 600; color: #58a6ff; }
    .stat-label { font-size: 0.8rem; color: #8b949e; margin-top: 5px; }
    .positive { color: #238636; }
    .negative { color: #f85149; }
    
    /* Holdings Table */
    .table-wrapper { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #30363d; }
    th { color: #8b949e; font-weight: 500; font-size: 0.85rem; }
    td { font-size: 0.9rem; }
    tr:hover { background: #21262d; }
    .ticker { font-weight: 600; color: #58a6ff; }
    
    /* Section headers */
    .section-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 20px 0 15px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #30363d;
    }
    .section-header h3 { font-size: 1rem; color: #c9d1d9; }
    .section-badge {
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .badge-stocks { background: #238636; color: white; }
    .badge-crypto { background: #f0883e; color: white; }
    
    /* Transaction Log */
    .transaction {
      display: flex;
      gap: 15px;
      padding: 15px;
      background: #0d1117;
      border-radius: 6px;
      margin-bottom: 10px;
      border-left: 3px solid #30363d;
    }
    .transaction.buy { border-left-color: #238636; }
    .transaction.sell { border-left-color: #f85149; }
    .transaction-date { color: #8b949e; font-size: 0.8rem; min-width: 80px; }
    .transaction-details { flex: 1; }
    .transaction-action { font-weight: 600; }
    .transaction-reason { color: #8b949e; font-size: 0.85rem; margin-top: 5px; }
    
    /* Thesis Cards */
    .thesis-card {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 15px;
    }
    .thesis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .thesis-ticker { font-weight: 600; font-size: 1.1rem; color: #58a6ff; }
    .thesis-conviction {
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .conviction-high { background: #238636; color: white; }
    .conviction-medium { background: #f0883e; color: white; }
    .conviction-low { background: #8b949e; color: white; }
    .thesis-text { font-size: 0.85rem; color: #c9d1d9; line-height: 1.5; margin-bottom: 10px; }
    .thesis-catalysts { font-size: 0.8rem; color: #8b949e; }
    .thesis-catalysts strong { color: #c9d1d9; }
    
    /* Watchlist */
    .watchlist-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: #0d1117;
      border-radius: 6px;
      margin-bottom: 8px;
      border: 1px solid #30363d;
    }
    .watchlist-item:hover { border-color: #58a6ff; }
    .watchlist-ticker { font-weight: 600; color: #58a6ff; }
    .watchlist-note { font-size: 0.8rem; color: #8b949e; margin-top: 3px; }
    .watchlist-price { text-align: right; }
    
    /* Macro indicators */
    .macro-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .macro-item {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 15px;
    }
    .macro-label { font-size: 0.8rem; color: #8b949e; margin-bottom: 5px; }
    .macro-value { font-size: 1.2rem; font-weight: 600; }
    .macro-desc { font-size: 0.75rem; color: #8b949e; margin-top: 5px; }
    
    /* Notes */
    .note {
      padding: 15px;
      background: #0d1117;
      border-radius: 6px;
      margin-bottom: 10px;
      border-left: 3px solid #a371f7;
    }
    .note.pinky { border-left-color: #58a6ff; }
    .note-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .note-date { font-size: 0.75rem; color: #8b949e; }
    .note-author { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; background: #21262d; }
    .note-text { font-size: 0.9rem; line-height: 1.5; }
    .note-tags { margin-top: 10px; display: flex; gap: 6px; flex-wrap: wrap; }
    .note-tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      background: #21262d;
      border-radius: 12px;
      color: #8b949e;
    }
    
    /* Chart */
    .chart-container { position: relative; height: 250px; }
    
    /* Buttons */
    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .btn-primary { background: #238636; color: white; }
    .btn-primary:hover { background: #2ea043; }
    .btn-secondary { background: #21262d; color: #c9d1d9; border: 1px solid #30363d; }
    .btn-secondary:hover { background: #30363d; }
    .btn-sm { padding: 5px 10px; font-size: 0.75rem; }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 25px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h2 { margin-bottom: 20px; font-size: 1.1rem; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; color: #8b949e; }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 10px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #c9d1d9;
      font-size: 0.9rem;
    }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: #58a6ff;
    }
    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
    
    /* Summary Bar */
    .summary-bar {
      display: flex;
      gap: 20px;
      padding: 15px 20px;
      background: #161b22;
      border-bottom: 1px solid #30363d;
      font-size: 0.85rem;
      flex-wrap: wrap;
    }
    .summary-item { display: flex; gap: 8px; align-items: center; }
    .summary-label { color: #8b949e; }
    .summary-value { font-weight: 600; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <h1>üîê Portfolio Dashboard</h1>
      <p>Enter your PIN to access</p>
      <input type="password" class="pin-input" id="pinInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" autofocus>
      <div class="login-error" id="loginError">Incorrect PIN</div>
      <button class="login-btn" onclick="checkPin()">Unlock</button>
    </div>
  </div>
  
  <!-- App Content -->
  <div class="app-content" id="appContent">
  <nav class="nav">
    <h1>üìä Portfolio Dashboard</h1>
    <div class="nav-tabs">
      <button class="nav-tab active" data-tab="overview">Overview</button>
      <button class="nav-tab" data-tab="holdings">Holdings</button>
      <button class="nav-tab" data-tab="theses">Theses</button>
      <button class="nav-tab" data-tab="transactions">Log</button>
      <button class="nav-tab" data-tab="watchlist">Watchlist</button>
      <button class="nav-tab" data-tab="macro">Macro</button>
      <button class="nav-tab" data-tab="notes">Notes</button>
    </div>
  </nav>
  
  <div class="summary-bar">
    <div class="summary-item">
      <span class="summary-label">Total Value:</span>
      <span class="summary-value" id="totalValue">$0</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">Cash:</span>
      <span class="summary-value" id="cashValue">$0</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">Positions:</span>
      <span class="summary-value" id="positionCount">0</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">Last Updated:</span>
      <span class="summary-value" id="lastUpdated">-</span>
    </div>
  </div>
  
  <div class="container">
    <!-- Overview Tab -->
    <div class="tab-content active" id="overview">
      <div class="grid-4" style="margin-bottom: 20px;">
        <div class="stat-card">
          <div class="stat-value" id="statStocks">$0</div>
          <div class="stat-label">Stocks</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statCrypto">$0</div>
          <div class="stat-label">Crypto</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statCash">$0</div>
          <div class="stat-label">Cash</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statAllocation">0%</div>
          <div class="stat-label">Invested</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">üìà Portfolio Value (Weekly)</span>
        </div>
        <div class="chart-container">
          <canvas id="valueChart"></canvas>
        </div>
      </div>
      
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <span class="card-title">üíº Top Holdings</span>
          </div>
          <div id="topHoldings"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">üß† Pinky's Thoughts</span>
            <button class="btn btn-sm btn-secondary" onclick="openNoteModal()">+ Add</button>
          </div>
          <div id="latestNotes"></div>
        </div>
      </div>
    </div>
    
    <!-- Holdings Tab -->
    <div class="tab-content" id="holdings">
      <div class="card">
        <div class="card-header">
          <span class="card-title">üíº Holdings by Value</span>
        </div>
        
        <div class="section-header">
          <h3>üìà Stocks</h3>
          <span class="section-badge badge-stocks" id="stocksTotal">$0</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Symbol</th><th>Name</th><th>Shares</th><th>Price</th><th>Value</th><th>Allocation</th></tr>
            </thead>
            <tbody id="stocksTable"></tbody>
          </table>
        </div>
        
        <div class="section-header">
          <h3>ü™ô Crypto</h3>
          <span class="section-badge badge-crypto" id="cryptoTotal">$0</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Symbol</th><th>Name</th><th>Amount</th><th>Price</th><th>Value</th><th>Allocation</th></tr>
            </thead>
            <tbody id="cryptoTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Theses Tab -->
    <div class="tab-content" id="theses">
      <div class="card">
        <div class="card-header">
          <span class="card-title">üí° Investment Theses</span>
          <button class="btn btn-sm btn-primary" onclick="openThesisModal()">+ Add Thesis</button>
        </div>
        <div class="grid-2" id="thesesGrid"></div>
      </div>
    </div>
    
    <!-- Transactions Tab -->
    <div class="tab-content" id="transactions">
      <div class="card">
        <div class="card-header">
          <span class="card-title">üìã Transaction Log</span>
          <button class="btn btn-sm btn-primary" onclick="openTransactionModal()">+ Log Transaction</button>
        </div>
        <div id="transactionLog"></div>
      </div>
    </div>
    
    <!-- Watchlist Tab -->
    <div class="tab-content" id="watchlist">
      <div class="card">
        <div class="card-header">
          <span class="card-title">üëÄ Stock Watchlist</span>
          <button class="btn btn-sm btn-primary" onclick="openWatchlistModal()">+ Add</button>
        </div>
        <div id="watchlistItems"></div>
      </div>
    </div>
    
    <!-- Macro Tab -->
    <div class="tab-content" id="macro">
      <div class="card">
        <div class="card-header">
          <span class="card-title">üåç US Liquidity & Macro Indicators</span>
        </div>
        <p style="color: #8b949e; margin-bottom: 20px; font-size: 0.85rem;">Key indicators to monitor for market direction. Liquidity drives everything.</p>
        <div class="macro-grid" id="macroGrid"></div>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">üìö Macro Resources</span>
        </div>
        <div id="macroResources"></div>
      </div>
    </div>
    
    <!-- Notes Tab -->
    <div class="tab-content" id="notes">
      <div class="card">
        <div class="card-header">
          <span class="card-title">üß† Market Notes & Thoughts</span>
          <button class="btn btn-sm btn-primary" onclick="openNoteModal()">+ Add Note</button>
        </div>
        <div id="allNotes"></div>
      </div>
    </div>
  </div>
  </div><!-- End app-content -->

  <!-- Modals -->
  <div class="modal-overlay" id="noteModal">
    <div class="modal">
      <h2>Add Note</h2>
      <form id="noteForm">
        <div class="form-group">
          <label>Note</label>
          <textarea id="noteText" required placeholder="What are you thinking about the market?"></textarea>
        </div>
        <div class="form-group">
          <label>Author</label>
          <select id="noteAuthor">
            <option value="chris">Chris</option>
            <option value="pinky">Pinky üß†</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tags (comma separated)</label>
          <input type="text" id="noteTags" placeholder="macro, crypto, earnings">
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('noteModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
  
  <div class="modal-overlay" id="transactionModal">
    <div class="modal">
      <h2>Log Transaction</h2>
      <form id="transactionForm">
        <div class="form-group">
          <label>Type</label>
          <select id="txType">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
        </div>
        <div class="form-group">
          <label>Symbol</label>
          <input type="text" id="txSymbol" required placeholder="TSLA">
        </div>
        <div class="form-group">
          <label>Shares/Amount</label>
          <input type="number" id="txShares" step="any" required>
        </div>
        <div class="form-group">
          <label>Price</label>
          <input type="number" id="txPrice" step="any" required>
        </div>
        <div class="form-group">
          <label>Reason / Notes</label>
          <textarea id="txReason" placeholder="Why did you make this trade?"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('transactionModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
  
  <div class="modal-overlay" id="watchlistModal">
    <div class="modal">
      <h2>Add to Watchlist</h2>
      <form id="watchlistForm">
        <div class="form-group">
          <label>Symbol</label>
          <input type="text" id="wlSymbol" required placeholder="CRWV">
        </div>
        <div class="form-group">
          <label>Notes / Why watching</label>
          <textarea id="wlNotes" placeholder="AI infrastructure pure play, watching for entry..."></textarea>
        </div>
        <div class="form-group">
          <label>Target Entry Price (optional)</label>
          <input type="number" id="wlTarget" step="any" placeholder="80.00">
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('watchlistModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
  
  <div class="modal-overlay" id="thesisModal">
    <div class="modal">
      <h2>Add Investment Thesis</h2>
      <form id="thesisForm">
        <div class="form-group">
          <label>Symbol</label>
          <input type="text" id="thSymbol" required placeholder="TSLA">
        </div>
        <div class="form-group">
          <label>Conviction</label>
          <select id="thConviction">
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="form-group">
          <label>Bull Case</label>
          <textarea id="thThesis" required placeholder="Why do you believe in this investment?"></textarea>
        </div>
        <div class="form-group">
          <label>Key Catalysts</label>
          <textarea id="thCatalysts" placeholder="What events could drive the price?"></textarea>
        </div>
        <div class="form-group">
          <label>Risks</label>
          <textarea id="thRisks" placeholder="What could go wrong?"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('thesisModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // PIN Authentication
    const CORRECT_PIN = '1984';
    const SESSION_KEY = 'portfolio-auth';
    
    function checkPin() {
      const pin = document.getElementById('pinInput').value;
      if (pin === CORRECT_PIN) {
        sessionStorage.setItem(SESSION_KEY, 'true');
        showApp();
      } else {
        document.getElementById('loginError').style.display = 'block';
        document.getElementById('pinInput').value = '';
        document.getElementById('pinInput').focus();
      }
    }
    
    function showApp() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appContent').style.display = 'block';
      initChart();
    }
    
    if (sessionStorage.getItem(SESSION_KEY) === 'true') {
      showApp();
    }
    
    document.getElementById('pinInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') checkPin();
    });
    
    // Data structure - defaults
    const DEFAULT_DATA = {
      holdings: [
        { symbol: 'TSLA', name: 'Tesla', shares: 185.31, price: 430.41, type: 'stock' },
        { symbol: 'CARR', name: 'Carrier Global', shares: 193.24, price: 59.58, type: 'stock' },
        { symbol: 'ANET', name: 'Arista Networks', shares: 77.07, price: 141.74, type: 'stock' },
        { symbol: 'NVDA', name: 'NVIDIA', shares: 38.57, price: 188.52, type: 'stock' },
        { symbol: 'FTNT', name: 'Fortinet', shares: 84.44, price: 81.26, type: 'stock' },
        { symbol: 'MRVL', name: 'Marvell Technology', shares: 83.81, price: 78.92, type: 'stock' },
        { symbol: 'SNOW', name: 'Snowflake', shares: 48.14, price: 192.70, type: 'stock' },
        { symbol: 'HIMS', name: 'Hims & Hers Health', shares: 545.40, price: 27.09, type: 'stock' },
        { symbol: 'MSTR', name: 'MicroStrategy', shares: 153.45, price: 149.71, type: 'stock' },
        { symbol: 'FIGR', name: 'Figure Technology', shares: 121, price: 64.49, type: 'stock' },
        { symbol: 'BTC', name: 'Bitcoin', shares: 1, price: 76352, type: 'crypto' },
        { symbol: 'SOL', name: 'Solana', shares: 121, price: 100.30, type: 'crypto' },
      ],
      cash: 45000,
      weeklyValues: [
        { date: '2026-01-06', value: 295000 },
        { date: '2026-01-13', value: 302000 },
        { date: '2026-01-20', value: 298000 },
        { date: '2026-01-27', value: 314000 },
        { date: '2026-02-02', value: 335000 },
      ],
      transactions: [
        { date: '2026-02-02', type: 'sell', symbol: 'LMT', shares: 20.66, price: 634.22, reason: 'Taking profits after 31% YTD run' },
        { date: '2026-02-02', type: 'sell', symbol: 'IONQ', shares: 107.74, price: 39.98, reason: 'Reducing speculative positions, want high growth stocks' },
        { date: '2026-02-02', type: 'sell', symbol: 'SERV', shares: 619.92, price: 10.43, reason: 'Reducing speculative positions' },
        { date: '2026-02-02', type: 'sell', symbol: 'SUI', shares: 18986.6, price: 1.10, reason: 'Lost confidence in alts short-term, crypto bear market' },
      ],
      theses: [
        { symbol: 'TSLA', conviction: 'high', thesis: 'Robotaxi and humanoid robots (Optimus) are not priced in. FSD improving rapidly. Energy business undervalued.', catalysts: 'Robotaxi launch, Optimus production, FSD v13', risks: 'Elon distraction, competition, macro' },
        { symbol: 'FIGR', conviction: 'medium', thesis: 'Forward-facing fintech that could be a leader in tokenization. RWA tokenization is a massive TAM.', catalysts: 'Tokenization adoption, regulatory clarity', risks: 'Regulatory risk, competition' },
        { symbol: 'NVDA', conviction: 'high', thesis: 'AI infrastructure backbone. Every major AI model runs on NVIDIA GPUs. Data center demand insatiable.', catalysts: 'Earnings Feb 25, Blackwell ramp, AI capex cycle', risks: 'China restrictions, AMD/custom silicon competition' },
        { symbol: 'MSTR', conviction: 'medium', thesis: 'Leveraged BTC play with corporate treasury strategy. Saylor accumulation continues.', catalysts: 'BTC price, potential S&P 500 inclusion', risks: 'BTC bear market, leverage risk' },
      ],
      watchlist: [
        { symbol: 'CRWV', notes: 'AI infrastructure pure play, down 50% from highs. Revenue exploding.', target: 80 },
        { symbol: 'MU', notes: 'HBM for AI, forward P/E only 13. Best value in semis.', target: 350 },
        { symbol: 'RKLB', notes: 'Space optionality, Neutron rocket catalyst.', target: 60 },
        { symbol: 'AMZN', notes: 'AWS + AI + advertising. Most diversified big tech.', target: null },
        { symbol: 'AVGO', notes: 'Custom AI chips for hyperscalers. OpenAI deal.', target: null },
        { symbol: 'CRWD', notes: 'Cybersecurity leader, recurring revenue.', target: null },
        { symbol: 'DDOG', notes: 'Observability for cloud. AI monitoring opportunity.', target: null },
        { symbol: 'GOOG', notes: 'Search + YouTube + Waymo optionality.', target: null },
        { symbol: 'META', notes: 'AI + Metaverse + advertising machine.', target: null },
        { symbol: 'MSFT', notes: 'Azure + OpenAI partnership + enterprise AI.', target: null },
        { symbol: 'PLTR', notes: 'Government + enterprise AI. High valuation but strong moat.', target: null },
        { symbol: 'ROK', notes: 'Industrial automation, reshoring beneficiary.', target: null },
        { symbol: 'TSMC', notes: 'Foundry monopoly for advanced chips.', target: null },
        { symbol: 'VRT', notes: 'Data center cooling/power infrastructure.', target: null },
      ],
      macroIndicators: [
        { id: 'm2', name: 'M2 Money Supply', value: '$21.5T', trend: 'up', desc: 'Total money in circulation. Rising = bullish for assets.' },
        { id: 'dxy', name: 'DXY (Dollar Index)', value: '103.5', trend: 'neutral', desc: 'Dollar strength. High = headwind for risk assets.' },
        { id: 'ppi', name: 'PPI (Producer Prices)', value: '+1.8% YoY', trend: 'down', desc: 'Wholesale inflation. Leading indicator for CPI.' },
        { id: 'cpi', name: 'CPI (Consumer Prices)', value: '+2.9% YoY', trend: 'down', desc: 'Consumer inflation. Fed watches this closely.' },
        { id: 'rrp', name: 'Reverse Repo (RRP)', value: '$500B', trend: 'down', desc: 'Liquidity parked at Fed. Draining = more market liquidity.' },
        { id: 'wresbal', name: 'WRESBAL (Bank Reserves)', value: '$3.3T', trend: 'neutral', desc: 'Bank reserves at Fed. Proxy for system liquidity.' },
        { id: 'wtregen', name: 'WTREGEN (Treasury General)', value: '$750B', trend: 'up', desc: 'Treasury cash balance. Drawdown = liquidity injection.' },
        { id: 'rates', name: 'Fed Funds Rate', value: '4.25-4.50%', trend: 'neutral', desc: 'Interest rate target. Cuts = bullish, hikes = bearish.' },
        { id: 'ism', name: 'ISM Manufacturing', value: '49.2', trend: 'up', desc: 'Factory activity. Above 50 = expansion.' },
        { id: 'nasdaq', name: 'Nasdaq Composite', value: '19,500', trend: 'up', desc: 'Tech-heavy index. Our portfolio beta.' },
      ],
      notes: [
        { date: '2026-02-02', author: 'pinky', text: 'Portfolio repositioning complete. Sold speculative positions (IONQ, SERV, SUI) and took profits on LMT. Now holding $45k cash for high-conviction entries. Looking for asymmetric setups where major catalysts aren\'t priced in.', tags: ['strategy', 'rebalancing'] },
        { date: '2026-02-02', author: 'pinky', text: 'Crypto in bear market ‚Äî alts getting crushed while BTC dominance climbs. Reduced exposure by selling SUI. Keeping BTC and SOL as core positions. Will reassess when sentiment shifts.', tags: ['crypto', 'macro'] },
        { date: '2026-02-02', author: 'pinky', text: 'Top watchlist candidates for 3X potential: CRWV (AI infra, high risk/reward), MU (best value in semis), RKLB (space optionality). Waiting for better entries ‚Äî patience over FOMO.', tags: ['watchlist', 'research'] },
        { date: '2026-02-02', author: 'chris', text: 'Want long term holds that can realistically 3X. Anything undervalued. TSLA thesis: robotaxi and humanoid robots aren\'t priced in.', tags: ['strategy', 'thesis'] },
      ],
      lastUpdated: new Date().toISOString()
    };
    
    // Load data - try localStorage, fall back to defaults
    let data;
    try {
      const stored = localStorage.getItem('portfolio-dashboard-v2');
      const parsed = stored ? JSON.parse(stored) : null;
      // Only use stored data if it has valid holdings
      data = (parsed && parsed.holdings && parsed.holdings.length > 0) ? parsed : JSON.parse(JSON.stringify(DEFAULT_DATA));
    } catch (e) {
      console.log('localStorage failed, using defaults:', e);
      data = JSON.parse(JSON.stringify(DEFAULT_DATA));
    }
    
    function save() {
      data.lastUpdated = new Date().toISOString();
      localStorage.setItem('portfolio-dashboard-v2', JSON.stringify(data));
    }
    
    function formatCurrency(n) {
      return '$' + n.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    }
    
    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
    }
    
    function calculateTotals() {
      const stocksValue = data.holdings.filter(h => h.type === 'stock').reduce((sum, h) => sum + h.shares * h.price, 0);
      const cryptoValue = data.holdings.filter(h => h.type === 'crypto').reduce((sum, h) => sum + h.shares * h.price, 0);
      const totalInvested = stocksValue + cryptoValue;
      const totalValue = totalInvested + data.cash;
      return { stocksValue, cryptoValue, totalInvested, totalValue };
    }
    
    let valueChart = null;
    
    function initChart() {
      const ctx = document.getElementById('valueChart')?.getContext('2d');
      if (!ctx) return;
      
      valueChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.weeklyValues.map(v => formatDate(v.date)),
          datasets: [{
            label: 'Portfolio Value',
            data: data.weeklyValues.map(v => v.value),
            borderColor: '#58a6ff',
            backgroundColor: 'rgba(88, 166, 255, 0.1)',
            fill: true,
            tension: 0.3,
            pointRadius: 4,
            pointBackgroundColor: '#58a6ff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: {
              grid: { color: '#30363d' },
              ticks: { color: '#8b949e' }
            },
            y: {
              grid: { color: '#30363d' },
              ticks: { 
                color: '#8b949e',
                callback: v => '$' + (v/1000) + 'k'
              }
            }
          }
        }
      });
    }
    
    function render() {
      const { stocksValue, cryptoValue, totalInvested, totalValue } = calculateTotals();
      
      // Summary bar
      document.getElementById('totalValue').textContent = formatCurrency(totalValue);
      document.getElementById('cashValue').textContent = formatCurrency(data.cash);
      document.getElementById('positionCount').textContent = data.holdings.length;
      document.getElementById('lastUpdated').textContent = formatDate(data.lastUpdated);
      
      // Overview stats
      document.getElementById('statStocks').textContent = formatCurrency(stocksValue);
      document.getElementById('statCrypto').textContent = formatCurrency(cryptoValue);
      document.getElementById('statCash').textContent = formatCurrency(data.cash);
      document.getElementById('statAllocation').textContent = Math.round(totalInvested / totalValue * 100) + '%';
      
      // Top holdings (sorted by value)
      const sorted = [...data.holdings].sort((a, b) => (b.shares * b.price) - (a.shares * a.price)).slice(0, 6);
      document.getElementById('topHoldings').innerHTML = sorted.map(h => `
        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #30363d;">
          <span><span class="ticker">${h.symbol}</span> <span style="color: #8b949e; font-size: 0.8rem;">${h.type === 'crypto' ? 'ü™ô' : ''}</span></span>
          <span>${formatCurrency(h.shares * h.price)}</span>
        </div>
      `).join('');
      
      // Latest notes (Pinky's thoughts)
      const pinkyNotes = data.notes.filter(n => n.author === 'pinky').slice(0, 2);
      document.getElementById('latestNotes').innerHTML = pinkyNotes.map(n => `
        <div class="note pinky">
          <div class="note-header">
            <span class="note-date">${formatDate(n.date)}</span>
            <span class="note-author">üß† Pinky</span>
          </div>
          <div class="note-text">${n.text}</div>
        </div>
      `).join('') || '<p style="color: #8b949e;">No thoughts yet</p>';
      
      // Holdings tables (separated and sorted by value)
      const stocks = data.holdings.filter(h => h.type === 'stock').sort((a, b) => (b.shares * b.price) - (a.shares * a.price));
      const crypto = data.holdings.filter(h => h.type === 'crypto').sort((a, b) => (b.shares * b.price) - (a.shares * a.price));
      
      document.getElementById('stocksTotal').textContent = formatCurrency(stocksValue);
      document.getElementById('cryptoTotal').textContent = formatCurrency(cryptoValue);
      
      document.getElementById('stocksTable').innerHTML = stocks.map(h => `
        <tr>
          <td class="ticker">${h.symbol}</td>
          <td>${h.name}</td>
          <td>${h.shares.toLocaleString()}</td>
          <td>$${h.price.toLocaleString()}</td>
          <td>${formatCurrency(h.shares * h.price)}</td>
          <td>${Math.round(h.shares * h.price / totalValue * 100)}%</td>
        </tr>
      `).join('');
      
      document.getElementById('cryptoTable').innerHTML = crypto.map(h => `
        <tr>
          <td class="ticker">${h.symbol}</td>
          <td>${h.name}</td>
          <td>${h.shares.toLocaleString()}</td>
          <td>$${h.price.toLocaleString()}</td>
          <td>${formatCurrency(h.shares * h.price)}</td>
          <td>${Math.round(h.shares * h.price / totalValue * 100)}%</td>
        </tr>
      `).join('');
      
      // Theses
      document.getElementById('thesesGrid').innerHTML = data.theses.map(t => `
        <div class="thesis-card">
          <div class="thesis-header">
            <span class="thesis-ticker">${t.symbol}</span>
            <span class="thesis-conviction conviction-${t.conviction}">${t.conviction.toUpperCase()}</span>
          </div>
          <div class="thesis-text">${t.thesis}</div>
          ${t.catalysts ? `<div class="thesis-catalysts"><strong>Catalysts:</strong> ${t.catalysts}</div>` : ''}
          ${t.risks ? `<div class="thesis-catalysts" style="margin-top: 5px;"><strong>Risks:</strong> ${t.risks}</div>` : ''}
        </div>
      `).join('') || '<p style="color: #8b949e;">No theses yet</p>';
      
      // Transaction log
      document.getElementById('transactionLog').innerHTML = data.transactions.map(t => `
        <div class="transaction ${t.type}">
          <div class="transaction-date">${formatDate(t.date)}</div>
          <div class="transaction-details">
            <div class="transaction-action">${t.type.toUpperCase()} ${t.shares.toLocaleString()} ${t.symbol} @ $${t.price}</div>
            ${t.reason ? `<div class="transaction-reason">${t.reason}</div>` : ''}
          </div>
        </div>
      `).join('') || '<p style="color: #8b949e;">No transactions yet</p>';
      
      // Watchlist
      document.getElementById('watchlistItems').innerHTML = data.watchlist.map(w => `
        <div class="watchlist-item">
          <div>
            <div class="watchlist-ticker">${w.symbol}</div>
            <div class="watchlist-note">${w.notes || ''}</div>
          </div>
          <div class="watchlist-price">
            ${w.target ? `<div style="font-size: 0.8rem; color: #8b949e;">Target: $${w.target}</div>` : ''}
            <button class="btn btn-sm btn-secondary" onclick="removeWatchlist('${w.symbol}')">√ó</button>
          </div>
        </div>
      `).join('') || '<p style="color: #8b949e;">No items in watchlist</p>';
      
      // Macro indicators
      const trendIcons = { up: 'üìà', down: 'üìâ', neutral: '‚û°Ô∏è' };
      document.getElementById('macroGrid').innerHTML = data.macroIndicators.map(m => `
        <div class="macro-item">
          <div class="macro-label">${m.name}</div>
          <div class="macro-value">${m.value} ${trendIcons[m.trend] || ''}</div>
          <div class="macro-desc">${m.desc}</div>
        </div>
      `).join('');
      
      // Macro resources
      document.getElementById('macroResources').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
          <a href="https://fred.stlouisfed.org/series/M2SL" target="_blank" class="watchlist-item" style="text-decoration: none;">
            <div><div class="watchlist-ticker">FRED M2</div><div class="watchlist-note">M2 Money Supply data</div></div>
          </a>
          <a href="https://fred.stlouisfed.org/series/RRPONTSYD" target="_blank" class="watchlist-item" style="text-decoration: none;">
            <div><div class="watchlist-ticker">FRED RRP</div><div class="watchlist-note">Reverse Repo data</div></div>
          </a>
          <a href="https://fred.stlouisfed.org/series/WRESBAL" target="_blank" class="watchlist-item" style="text-decoration: none;">
            <div><div class="watchlist-ticker">FRED WRESBAL</div><div class="watchlist-note">Bank Reserves</div></div>
          </a>
          <a href="https://www.tradingview.com/symbols/TVC-DXY/" target="_blank" class="watchlist-item" style="text-decoration: none;">
            <div><div class="watchlist-ticker">DXY Chart</div><div class="watchlist-note">Dollar Index on TradingView</div></div>
          </a>
          <a href="https://www.ismworld.org/supply-management-news-and-reports/reports/ism-report-on-business/" target="_blank" class="watchlist-item" style="text-decoration: none;">
            <div><div class="watchlist-ticker">ISM Reports</div><div class="watchlist-note">Manufacturing & Services PMI</div></div>
          </a>
        </div>
      `;
      
      // All notes
      document.getElementById('allNotes').innerHTML = data.notes.map(n => `
        <div class="note ${n.author === 'pinky' ? 'pinky' : ''}">
          <div class="note-header">
            <span class="note-date">${formatDate(n.date)}</span>
            <span class="note-author">${n.author === 'pinky' ? 'üß† Pinky' : 'üë§ Chris'}</span>
          </div>
          <div class="note-text">${n.text}</div>
          ${n.tags?.length ? `<div class="note-tags">${n.tags.map(t => `<span class="note-tag">${t}</span>`).join('')}</div>` : ''}
        </div>
      `).join('') || '<p style="color: #8b949e;">No notes yet</p>';
    }
    
    // Tab switching
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });
    
    // Modal functions
    function openNoteModal() { document.getElementById('noteModal').classList.add('active'); }
    function openTransactionModal() { document.getElementById('transactionModal').classList.add('active'); }
    function openWatchlistModal() { document.getElementById('watchlistModal').classList.add('active'); }
    function openThesisModal() { document.getElementById('thesisModal').classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    
    // Form handlers
    document.getElementById('noteForm').addEventListener('submit', e => {
      e.preventDefault();
      data.notes.unshift({
        date: new Date().toISOString().split('T')[0],
        author: document.getElementById('noteAuthor').value,
        text: document.getElementById('noteText').value,
        tags: document.getElementById('noteTags').value.split(',').map(t => t.trim()).filter(t => t)
      });
      save(); render(); closeModal('noteModal');
      document.getElementById('noteForm').reset();
    });
    
    document.getElementById('transactionForm').addEventListener('submit', e => {
      e.preventDefault();
      data.transactions.unshift({
        date: new Date().toISOString().split('T')[0],
        type: document.getElementById('txType').value,
        symbol: document.getElementById('txSymbol').value.toUpperCase(),
        shares: parseFloat(document.getElementById('txShares').value),
        price: parseFloat(document.getElementById('txPrice').value),
        reason: document.getElementById('txReason').value
      });
      save(); render(); closeModal('transactionModal');
      document.getElementById('transactionForm').reset();
    });
    
    document.getElementById('watchlistForm').addEventListener('submit', e => {
      e.preventDefault();
      data.watchlist.push({
        symbol: document.getElementById('wlSymbol').value.toUpperCase(),
        notes: document.getElementById('wlNotes').value,
        target: parseFloat(document.getElementById('wlTarget').value) || null
      });
      save(); render(); closeModal('watchlistModal');
      document.getElementById('watchlistForm').reset();
    });
    
    document.getElementById('thesisForm').addEventListener('submit', e => {
      e.preventDefault();
      data.theses.push({
        symbol: document.getElementById('thSymbol').value.toUpperCase(),
        conviction: document.getElementById('thConviction').value,
        thesis: document.getElementById('thThesis').value,
        catalysts: document.getElementById('thCatalysts').value,
        risks: document.getElementById('thRisks').value
      });
      save(); render(); closeModal('thesisModal');
      document.getElementById('thesisForm').reset();
    });
    
    function removeWatchlist(symbol) {
      data.watchlist = data.watchlist.filter(w => w.symbol !== symbol);
      save(); render();
    }
    
    // Close modals on overlay click
    document.querySelectorAll('.modal-overlay').forEach(m => {
      m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); });
    });
    
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
    });
    
    render();
  </script>
</body>
</html>
